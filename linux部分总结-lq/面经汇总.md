# 面经汇总

#### 1、sort用的什么算法？

​	（1）插入排序（2）快速排序

​	STL定义了一个SORT_MAX变量来判断，如果大于SORT_MAX就用快排进行分段排序，分段后的数据量小于阈值后，使用 	插入排序，若递归层次过深，会改用堆排序。

#### 2、Linux查看磁盘空间

- **df 命令以磁盘分区为单位查看文件系统中磁盘空间的使用情况**		

  df -h 以人类可读方式打印     df -i  查看分区inode'使用情况

- du查看文件或目录的磁盘使用的空间。		

#### 3、为什么共享内存比管道快？不是都放在内存吗？

​	管道需要两次内核的拷贝。用一个用户的用户空间拷贝到内核空间，再从内核空间拷贝到另一个用户进程。

​	而共享内存不涉及内核的拷贝，可直接访问，不涉及系统调用。

#### 4、redis的存储结构

​	字符串对象、列表对象、哈希对象、集合对象、有序集合对象

#### 5、DNS寻址用的协议？

​     域名解析时使用UDP协议。

#### 6、epoll怎么实现的？



#### 7、第k小的数字有什么方法找？

​    快排。

#### 8、死锁产生的条件，怎样避免死锁

​	必要条件：

- 互斥条件：每个资源要么已经分配给了一个进程，要么就是可用的。
- 占有和等待条件：已经得到资源的进程可以再次申请新的资源。
- 不可抢占条件：已经分配的资源不能从相应的进程中强制剥夺。
- 环路等待条件：系统中若干进程组成环路，该环路中每个进程都在等待相邻进程正占用的资源。

​	死锁避免：

​	动态地检测资源分配状态，以确保循环等待条件不成立，从而确保系统处于安全状态。

​	银行家算法：对每一个请求进行检查，检查如果满足这一请求系统是否处于安全状态，若是，就满足，若不是，就推迟这一请求。

#### 9、协程



#### 10、100本书，每人最多拿5本，取最后一本的人胜利，你会采用什么策略？

先拿4本书，后面保证下次拿得本数与另一人之前拿得本数相加等于6。

#### 11、redo log（重做）和undo log（回滚）

- undo log是为了实现事务的原子性；undo还用来实现多版本并发控制（MVCC）。

  1. 为实现事务的原子性，在操作任何数据之前，首先将数据备份到undo log。

  ​    A. 事务开始

  ​	B.记录A=1到undo log

  ​	C.修改A=3

  ​	D.记录B=2到undo log

  ​	E.修改B=4

  ​	F.将undo log写到磁盘

  ​	G.将数据写到磁盘

  ​	H.事务提交

  undo log主要特点是更新数据前记录undo log；必须在事务提交前将undo log写到磁盘。

- Redo log保存执行的SQL语句到指定的log文件中，当mysql执行数据恢复时，把已经commited的事务重做一遍，对于没有commited的事务按照abort处理。

   Redo log特点：

  1. 尽量保持Redo log存储在一段连续的空间上。因此在系统第一次启动时就会将日志文件的空间完全分配。顺序追加方式记录redo log
  2. 批量写入日志。日志并不是直接写入文件，而是先写入redo log buffer。当需要将日志刷新到磁盘时，将许多日志一起写入磁盘
  3. 并发的事务共享Redo log的存储空间，它们的redo log按语句的执行顺序，依次交替的记录在一起，以减少日志占用的空间。
  4. 因为3的原因，当一个事务将redo log写入磁盘时，其他未提交的事务的日志也会写入磁盘。
  5. redo log 上只执行顺序追加的操作，当一个事务需要回滚时，它的redo log记录也不会从redo log中删除。

  

  Undo + Redo事务的简化过程

  ​	A. 事务开始

  ​	B.记录A=1到undo log

  ​	C.修改A=3

  ​	D.记录A=3到redo log

  ​	E.记录B=2到undo log

  ​	F.修改B=4

  ​	G.记录B=4到Redo log

  ​	H.将redo log写入磁盘

  ​	I.事务提交

  

  ##### 恢复

  未提交的事务和回滚了的事务也会记录redo log, 因此恢复策略有两种：

  A：进行恢复时，只重做已经提交了的事务。

  B：进行恢复时，重做所有事务包括未提交的事务和回滚 的事务。然后通过undo log回滚那些未提交的事务。

  

  

  

  #### 在浏览器输入www.baidu.com后执行的全部过程

  #### 简略版

1、浏览器获取输入的域名www.baidu.com

2、浏览器向DNS请求解析www.baidu.com的IP地址。

3、域名系统DNS解析出IP地址

4、浏览器与服务器建立TCP连接(HTTP 默认端口80)

5、浏览器发出HTTP请求

6、服务器通过HTTP响应把文件发送给浏览器

7、浏览器将首页文件进行解析，并将web页显示给用户

涉及的协议：

1、应用层：HTTP，DNS（域名解析服务）

2、传输层：TCP（为HTTP提供可靠的数据传输），UDP（DNS使用UDP传输）

3、网络层：IP（IP数据包传输和路由选择），ICMP（提供传输过程中的差错检测）

#### 详细版

##### 一、浏览器先解析URL，确定web服务器和文件名，生成HTTP请求消息。

##### 二、真实地址查询DNS

​	浏览器生成HTTP消息后，需要委托操作系统将消息发送给web服务器，这是需要向操作系统提供通信对象的IP地址。

​	通过DNS协议解析出IP地址。大致过程为：

- ​	客户端发出DNS请求给本地DNS服务器，本地DNS服务器查看缓存，若有直接返回。若无，下一步
- ​    本地DNS查询根域名服务器，根域名服务器返回顶级域名服务器地址。
- ​    本地DNS向顶级域名服务器查询，顶级域名服务器返回权威服务器地址。
- ​    本地DNS向权威服务器查询，权威服务器返回IP地址。
- ​    本地DNS将IP地址返回客户端。

##### 三、获得IP地址后，将HTTP的传输工作交给操作系统的协议栈

应用程序通过调用Socket库，来委托协议栈工作。

操作系统协议栈上半部分有负责收发数据的TCP和UDP协议，

协议栈的下半部分是通过IP协议控制网络包收发操作。此外网络层还包括ICMP协议和ARP协议。

- ICMP用于告知网络包传送过程中产生的错误以及各种控制信息。
- ARP用于根据IP地址查询相应的以太网MAC地址。

##### 四、HTTP基于TCP协议传输。

​    HTTP传输数据之前，TCP先通过三次握手与服务器建立连接，保证通信双方都有发送和接收能力。（netstat -napt）

​	若HTTP请求消息过长超过MSS长度，这时TCP会把数据拆解分块；TCP协议通过添加头部生成TCP报文后，就交给下面的	网络层处理。

![image-20210519091709711](C:\Users\IMGLIU\AppData\Roaming\Typora\typora-user-images\image-20210519091709711.png)



##### 五、通过IP协议将数据封装成网络包发送给通信对象。

IP协议添加IP头部时需要有源地址IP和目的地址IP，HTTP经TCP传输，所以IP包头协议号为0x06；

在添加源地址IP时，若存在多张网卡时，需要根据路由表规则判断选择哪一个源地址IP（route -n）。

- 将目的地址与每个条目的子网掩码相与，判断结果与条目中的Destination是否相同，若相同取该源地址IP，若都不相同，则使用默认网关。

有了IP包头后，数据包就有了远程定位能力，但这时还需要知道数据包下一站传输至何处。

##### 六、两点传输 --MAC地址

生成IP头部后，网络包还需要再IP头部前面加上MAC头部。

MAC包头需要发送方MAC地址和接收方MAC地址，用于两点传输确认下一站接收方。

- 发送方的MAC地址通过读取ROM就可以知道。

- 接收方的MAC地址需要查看路由表，找到匹配条目即可。

  若路由表中没有相应条目，就会通过ARP协议向以太网内所有设备广播查询；操作系统会将查询到的结果放入ARP缓存。(arp -a)   

##### 七、出口--网卡

IP生成的网络包通过网卡将数据发送出去

网卡驱动从IP模块获取到包后，将其复制到网卡内的缓存区中，接着在其开头加上报头和起始帧分界符，在末尾加上用于检测错误的帧校验序列。

然后，数据包通过交换机将网络包原样转发到目的地。交换机工作在MAC层，是二层网络设备。

**交换机根据 MAC 地址表查找 MAC 地址，然后将信号发送到相应的端口**。

##### 八、路由器转发数据包，直至最终目的地

网络包经过交换机后，到达路由器，并在此确定下一个路由器或目标设备。

- 路由器是基于IP设计的，路由器每个端口都有IP地址和MAC地址，俗称三层网络设备。

路由器端口只接收与自己MAC地址匹配的包。

完成包接收后，路由器会丢掉包开头的MAC头部，然后路由器根据网络包的IP头部进行包转发。 

- 首先判断查询路由表判断转发目标。
- 根据路由表的网关列判断对方的地址，若网关列是IP地址，则IP地址为转发的目标；若为空，则接收方IP地址为转发的目标。
- 然后路由器根据ARP协议查询MAC地址
- 最终添加 MAC包头，转发网络包。

##### 九、到达服务器端，解析数据包

- 数据包抵达服务器后，服务器先扒开数据包MAC地址，查看是否与自己匹配

- 接着解析数据包的IP头，根据IP头的协议项，知道上层是TCP协议。
- 再解析TCP头，查看里面的序列号是不是想要的，如果是则放入缓存返回ACK；否则丢弃。
- TCP头里有端口号，而HTTP正在监听这个端口，系统就把包发送给HTTP进程。
- 服务器解析HTTP报文后，返回响应报文。

